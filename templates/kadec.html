<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <title>Download Flask!</title>
</head>

<body>
  <div class="container">
    <div class="row">
      <h1>Download the file</h1>
      {% for image in images %}
      <span class="link-container" style="margin-bottom: 20px;">
        <a href="{{ url_for('kadec_download', image_file=image) }}">
          <img src="static/kadec/{{image}}" alt="{{ image }}" width="100">
        </a>
        <button class="btn btn-primary" data-value="{{ image }}">Copiar URL</button>
      </span>
      {% endfor %}
    </div>
  </div>
</body>
<script>
  const allButtons = document.getElementsByTagName("button")
  for (const btn of allButtons) {
    btn.addEventListener('click', (e) => {
      e.preventDefault()

      const buttonDataValue = btn.dataset.value;
      const productUrl = buttonDataValue.replace(/_/g, "/").replace('.webp', '')
      // const pid = /(\w+).webp$/.exec(buttonDataValue)[1]
      
      if (productUrl.includes('amazon.com')) {
        const gui = 'blackshop0e-20'
        const afiliateUrl = `${productUrl}?tag=${gui}&language=pt_BR&ref_=as_li_ss_tl`
        navigator.clipboard.writeText(afiliateUrl)
        btn.innerText = "Copiado!"
      }

      if (productUrl.includes('magazineluiza.com')) {
        const afiliateUrl = productUrl.replace('magazineluiza.com.br/', 'magazinevoce.com.br/magazinefkfinz/')
        navigator.clipboard.writeText(afiliateUrl)
        btn.innerText = "Copiado!"
      }
    })
  }
</script>

</html>
